# 로드 밸런싱(Load Balancing)

 

서버가 단 하나만 존재할 때 많은 사용자들이 동시에 접속을 할 때 부하를 감당하지 못한다.

이를 해결하는 방식에는 장비를 업그레이드하는 Scale-Up 방식과 장비의 개수를 추가하는 Scale-Out 방식이 있다.

Sclae-Out 방식으로 여러 서버를 둔다면 해당 서비스에 접근하기 위해 서버마다 다른 IP가 필요하다.

서버마다 다른 IP를 부여한다면 각각 사용자들은 다른 IP로 접속할 것이고 개발자가 원하는 부하 분산을 하기 어려워 진다.



Ex) 100명의 사용자와 2개의 서버가 존재할 때, 99명의 사용자가 서버1에 접속하고 1명의 사용자가 서버2에 접속할 경우



이를 방지하기 위해 서버를 분산하고 사용자를 분산시켜주는 작업이 필요하다. 이렇게 두 개 이상의 컴퓨터 자원에 작업을 나누는것을 로드밸런싱 이라고 한다.



#### 로드밸런서의 종류

로드밸런서는 OSI 7계층을 기준으로 어떻게 부하를 분산하는지에 따라 종류가 나뉜다. 2 계층을 기준으로 부하를 분산한다면 L2, 3 계층을 기준으로 부하를 분산한다면 L3인 방식. 상위 계층으로 갈수록 섬세한 부하 분산이 가능하지만 가격이 비싸진다. 하위 계층으로 갈수록 간단한 부하 분산이 가능하고 가격이 저렴해진다.



| L2     | Data Link 계층을 사용, Mac주소 기반 부하 분산         |                    |
| ------ | ----------------------------------------------------- | ------------------ |
| **L3** | **Network 계층을 사용, IP주소 기반 부하 분산**        |                    |
| **L4** | **Transport 계층을 사용, Port 기반 부하 분산**        | **TCP, UDP**       |
| **L7** | **Application 계층을 사용, 요청(URL) 기반 부하 부산** | **HTTP, HTTPS 등** |



#### 로드밸런싱 알고리즘

• 라운드로빈 방식(Round Robin Method)
서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식. 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합.

• 가중 라운드로빈 방식(Weighted Round Robin Method)
각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분. 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식입니다. 예를 들어 A라는 서버가 5라는 가중치를 갖고 B라는 서버가 2라는 가중치를 갖는다면, 로드밸런서는 라운드로빈 방식으로 A 서버에 5개 B 서버에 2개의 요청을 전달.

• IP 해시 방식(IP Hash Method)
클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식. 사용자의 IP를 해싱해(Hashing, 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑하는 것, 또는 그러한 함수) 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장. 

• 최소 연결 방식(Least Connection Method)
요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분. 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식.

• 최소 리스폰타임(Least Response Time Method)
서버의 현재 연결 상태와 응답시간(Response Time, 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간)을 모두 고려하여 트래픽을 배분. 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분하는 방식.





> 참고
>
> https://medium.com/harrythegreat/aws-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-9fd0955f859e
>
> https://post.naver.com/viewer/postView.nhn?volumeNo=27046347&memberNo=2521903
>
> https://velog.io/@jisoo1170/Load-Balancing%EC%9D%B4%EB%9E%80
>
> https://deveric.tistory.com/91
>
> https://asfirstalways.tistory.com/320

